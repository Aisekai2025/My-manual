<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§ã®èª¬æ˜æ›¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* --- å¤‰æ•°å®šç¾©ï¼ˆãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºç”¨ï¼‰ --- */
        :root {
            --bg-color: #FDFBF7; /* æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ™ãƒ¼ã‚¸ãƒ¥ç³»èƒŒæ™¯ */
            --text-color: #5C4B40;
            --card-bg: #FFFFFF;
            --accent-color: #D4A373; /* è½ã¡ç€ã„ãŸã‚ªãƒ¬ãƒ³ã‚¸/ãƒ–ãƒ©ã‚¦ãƒ³ç³» */
            --spell-color: #E29578; /* å›å¾©å‘ªæ–‡ç”¨ã®å°‘ã—ç›®ç«‹ã¤è‰² */
            --font-size-base: 16px;
            --border-radius: 16px;
        }

        /* --- ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body {
            font-family: 'Kiwi Maru', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: var(--font-size-base);
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, font-size 0.3s;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px dashed var(--accent-color);
            padding-bottom: 10px;
        }

        h1 {
            font-size: 1.5rem;
            margin: 0;
            color: var(--accent-color);
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        /* --- ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
        button {
            font-family: inherit;
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: opacity 0.2s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        button.outline {
            background-color: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        /* --- è¨­å®šãƒ‘ãƒãƒ« --- */
        #settings-panel {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: none; /* åˆæœŸéè¡¨ç¤º */
        }
        
        .setting-item {
            margin-bottom: 10px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        /* --- ã‚«ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- */
        .section-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .section-card h2 {
            font-size: 1.2rem;
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- ãƒªã‚¹ãƒˆé …ç›®ã¨ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ --- */
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-color);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* æç¤ºãƒ¢ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ©ãƒ™ãƒ«ï¼‰ */
        .public-label {
            font-size: 0.8rem;
            color: #888;
            margin-right: 8px;
        }

        /* --- éŸ³å£°å…¥åŠ›æ—¥è¨˜ --- */
        #diary-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 200px;
            overflow-y: auto;
        }

        #diary-list li {
            background-color: #F9F6F0;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            position: relative;
        }
        
        .diary-date {
            font-size: 0.7rem;
            color: #999;
            display: block;
            margin-bottom: 4px;
        }

        #record-btn {
            width: 100%;
            background-color: #E29578;
            margin-bottom: 15px;
        }
        
        #record-btn.recording {
            background-color: #D62828;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* --- æç¤ºãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ --- */
        #presentation-view {
            display: none; /* åˆæœŸéè¡¨ç¤º */
        }

        .presentation-card {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            text-align: center;
        }

        .presentation-card h2 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 20px;
        }

        .presentation-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .tag {
            background-color: #F9F6F0;
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1rem;
            border: 1px solid #EAE2D6;
        }

        /* å›å¾©å‘ªæ–‡ã®ç‰¹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
        .spell-card {
            border: 2px solid var(--spell-color);
            background-color: #FFF9F7;
        }
        
        .spell-card h2 {
            color: var(--spell-color);
            border-color: var(--spell-color);
        }

        .spell-tag {
            background-color: var(--spell-color);
            color: white;
            border: none;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 id="app-title">ç§ã®èª¬æ˜æ›¸ ğŸ“–</h1>
        <div class="header-buttons">
            <button id="toggle-settings-btn" class="outline" onclick="toggleSettings()">âš™ï¸ è¨­å®š</button>
            <button id="mode-switch-btn" onclick="toggleMode()">ğŸ‘€ æç¤ºãƒ¢ãƒ¼ãƒ‰ã¸</button>
        </div>
    </header>

    <div id="settings-panel">
        <div class="setting-item">
            <label for="font-size-slider">æ–‡å­—ã®å¤§ãã•</label>
            <input type="range" id="font-size-slider" min="12" max="24" value="16" onchange="updateSettings()">
        </div>
        <div class="setting-item">
            <label for="bg-color-picker">èƒŒæ™¯è‰²</label>
            <input type="color" id="bg-color-picker" value="#FDFBF7" onchange="updateSettings()">
        </div>
    </div>

    <div id="edit-view">
        <p style="font-size: 0.9rem; color: #888;">
            â€»ç›¸æ‰‹ã«è¦‹ã›ãŸã„é …ç›®ã ã‘ã‚¹ã‚¤ãƒƒãƒã‚’ONã«ã—ã¦ãã ã•ã„ã€‚<br>
            â€»ãƒ‡ãƒ¼ã‚¿ã¯ã‚ãªãŸã®ç«¯æœ«å†…ã«ã®ã¿å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
        </p>

        <div class="section-card">
            <h2>ğŸ§© ç§ã®ã‚¯ã‚»ãƒ»ç‰¹å¾´</h2>
            <div id="habits-list"></div>
        </div>

        <div class="section-card">
            <h2>ğŸ§­ å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³</h2>
            <div id="values-list"></div>
        </div>

        <div class="section-card" style="border-left: 4px solid var(--spell-color);">
            <h2>âœ¨ å›å¾©å‘ªæ–‡ (å–æ‰±æ³¨æ„)</h2>
            <p style="font-size: 0.8rem; margin-top: -10px;">ã“ã‚Œã‚’ã•ã‚Œã‚‹ã¨å¬‰ã—ã„ãƒ»æ©Ÿå«ŒãŒç›´ã‚‹ãƒªã‚¹ãƒˆ</p>
            <div id="spells-list"></div>
        </div>

        <div class="section-card" style="background-color: #F0F4F8;">
            <h2>ğŸ™ï¸ å¿ƒã®è–åŸŸ (éŸ³å£°æ—¥è¨˜)</h2>
            <p style="font-size: 0.8rem; margin-top: -10px;">â€»ã“ã®é ˜åŸŸã¯æç¤ºãƒ¢ãƒ¼ãƒ‰ã§ã¯çµ¶å¯¾ã«è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
            <button id="record-btn" onclick="toggleRecording()">ğŸ¤ ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹</button>
            <ul id="diary-list"></ul>
        </div>
    </div>

    <div id="presentation-view">
        <p style="text-align: center; color: #888; font-size: 0.9rem;">
            ã¯ã˜ã‚ã¾ã—ã¦ã€‚å††æ»‘ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã€<br>ç§ã®ç‰¹å¾´ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
        </p>
        
        <div class="presentation-card">
            <h2>ğŸ§© ç§ã®ã‚¯ã‚»ãƒ»ç‰¹å¾´</h2>
            <div class="presentation-tags" id="presen-habits"></div>
        </div>

        <div class="presentation-card">
            <h2>ğŸ§­ å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³</h2>
            <div class="presentation-tags" id="presen-values"></div>
        </div>

        <div class="presentation-card spell-card">
            <h2>âœ¨ ç§ã®å›å¾©å‘ªæ–‡</h2>
            <div class="presentation-tags" id="presen-spells"></div>
        </div>
    </div>

</div>

<script>
    /* --- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨åˆæœŸåŒ– --- */
    // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿
    const defaultData = {
        habits: [
            { id: 'h1', text: 'å›é¿å‚¾å‘ãŒã‚ã‚‹', isPublic: false },
            { id: 'h2', text: 'å®Œç’§ä¸»ç¾©ã«ãªã‚ŠãŒã¡', isPublic: false },
            { id: 'h3', text: 'ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ãŒè‹¦æ‰‹', isPublic: true },
            { id: 'h4', text: 'éŸ³ã‚„å…‰ã«å°‘ã—æ•æ„Ÿ (æ„Ÿè¦šéæ•)', isPublic: false },
            { id: 'h5', text: 'éé›†ä¸­ãƒ»æ²¡é ­å‹', isPublic: true }
        ],
        values: [
            { id: 'v1', text: 'èª å®Ÿã•', isPublic: true },
            { id: 'v2', text: 'çŸ¥çš„å¥½å¥‡å¿ƒ', isPublic: true },
            { id: 'v3', text: 'ä»–è€…ã¸ã®è²¢çŒ®', isPublic: false },
            { id: 'v4', text: 'è‡ªå¾‹ã¨è‡ªç”±', isPublic: true },
            { id: 'v5', text: 'å¿ƒã®å¹³ç©', isPublic: true }
        ],
        spells: [
            { id: 's1', text: 'ã€Œä¼‘ã‚“ã§ã„ã„ã‚ˆã€ã®ä¸€è¨€', isPublic: true },
            { id: 's2', text: 'æ¸©ã‹ã„é£²ã¿ç‰©ã®å·®ã—å…¥ã‚Œ', isPublic: true },
            { id: 's3', text: '1äººã®æ™‚é–“ã‚’ãã‚Œã‚‹ã“ã¨', isPublic: false }
        ],
        diary: [],
        settings: {
            fontSize: 16,
            bgColor: '#FDFBF7'
        }
    };

    let appData = {};

    // LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    function loadData() {
        const savedData = localStorage.getItem('my_manual_data');
        if (savedData) {
            appData = JSON.parse(savedData);
        } else {
            appData = JSON.parse(JSON.stringify(defaultData));
        }
        applySettings();
        renderEditView();
        renderDiary();
    }

    // LocalStorageã¸ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹
    function saveData() {
        localStorage.setItem('my_manual_data', JSON.stringify(appData));
    }

    /* --- UIæç”» (ç·¨é›†ãƒ¢ãƒ¼ãƒ‰) --- */
    function renderList(containerId, category) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        appData[category].forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'item-row';
            
            const textSpan = document.createElement('span');
            textSpan.textContent = item.text;
            
            const rightDiv = document.createElement('div');
            rightDiv.style.display = 'flex';
            rightDiv.style.alignItems = 'center';

            const label = document.createElement('span');
            label.className = 'public-label';
            label.textContent = 'æç¤ºã™ã‚‹';

            const labelNode = document.createElement('label');
            labelNode.className = 'toggle-switch';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = item.isPublic;
            checkbox.onchange = (e) => {
                appData[category][index].isPublic = e.target.checked;
                saveData();
            };

            const slider = document.createElement('span');
            slider.className = 'slider';

            labelNode.appendChild(checkbox);
            labelNode.appendChild(slider);
            
            rightDiv.appendChild(label);
            rightDiv.appendChild(labelNode);

            row.appendChild(textSpan);
            row.appendChild(rightDiv);
            container.appendChild(row);
        });
    }

    function renderEditView() {
        renderList('habits-list', 'habits');
        renderList('values-list', 'values');
        renderList('spells-list', 'spells');
    }

    /* --- è¨­å®šãƒ‘ãƒãƒ«é–¢é€£ --- */
    function toggleSettings() {
        const panel = document.getElementById('settings-panel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    function applySettings() {
        document.documentElement.style.setProperty('--font-size-base', appData.settings.fontSize + 'px');
        document.documentElement.style.setProperty('--bg-color', appData.settings.bgColor);
        document.getElementById('font-size-slider').value = appData.settings.fontSize;
        document.getElementById('bg-color-picker').value = appData.settings.bgColor;
    }

    function updateSettings() {
        const fontSize = document.getElementById('font-size-slider').value;
        const bgColor = document.getElementById('bg-color-picker').value;
        
        appData.settings.fontSize = fontSize;
        appData.settings.bgColor = bgColor;
        
        applySettings();
        saveData();
    }

    /* --- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ (æç¤ºãƒ¢ãƒ¼ãƒ‰) --- */
    let isPresentationMode = false;

    function toggleMode() {
        isPresentationMode = !isPresentationMode;
        
        const editView = document.getElementById('edit-view');
        const presenView = document.getElementById('presentation-view');
        const modeBtn = document.getElementById('mode-switch-btn');
        const settingsBtn = document.getElementById('toggle-settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        
        if (isPresentationMode) {
            // æç¤ºãƒ¢ãƒ¼ãƒ‰ã¸ç§»è¡Œ
            editView.style.display = 'none';
            settingsBtn.style.display = 'none';
            settingsPanel.style.display = 'none';
            presenView.style.display = 'block';
            modeBtn.innerHTML = 'ğŸ”™ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¸æˆ»ã‚‹';
            modeBtn.classList.add('outline');
            renderPresentationView();
        } else {
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¸æˆ»ã‚‹
            editView.style.display = 'block';
            settingsBtn.style.display = 'inline-block';
            presenView.style.display = 'none';
            modeBtn.innerHTML = 'ğŸ‘€ æç¤ºãƒ¢ãƒ¼ãƒ‰ã¸';
            modeBtn.classList.remove('outline');
        }
    }

    function renderTags(containerId, category, tagClass) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        // isPublic ãŒ true ã®ã‚‚ã®ã ã‘æŠ½å‡º
        const publicItems = appData[category].filter(item => item.isPublic);
        
        if (publicItems.length === 0) {
            container.innerHTML = '<span style="color:#aaa; font-size:0.9rem;">(éå…¬é–‹)</span>';
            return;
        }

        publicItems.forEach(item => {
            const span = document.createElement('span');
            span.className = `tag ${tagClass}`;
            span.textContent = item.text;
            container.appendChild(span);
        });
    }

    function renderPresentationView() {
        renderTags('presen-habits', 'habits', '');
        renderTags('presen-values', 'values', '');
        renderTags('presen-spells', 'spells', 'spell-tag'); // å›å¾©å‘ªæ–‡ã¯ç‰¹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ«
    }

    /* --- éŸ³å£°å…¥åŠ›æ—¥è¨˜ (Web Speech API) --- */
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let isRecording = false;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.continuous = true;
        recognition.interimResults = false;

        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript;
            addDiaryEntry(transcript);
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            alert('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + event.error);
            stopRecording();
        };
    }

    function toggleRecording() {
        if (!SpeechRecognition) {
            alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚(Chromeã‚„Safariã®æœ€æ–°ç‰ˆã‚’ã”åˆ©ç”¨ãã ã•ã„)');
            return;
        }

        const btn = document.getElementById('record-btn');
        
        if (isRecording) {
            stopRecording();
        } else {
            startRecording();
        }
    }

    function startRecording() {
        recognition.start();
        isRecording = true;
        const btn = document.getElementById('record-btn');
        btn.innerHTML = 'â¹ï¸ éŒ²éŸ³ã‚’åœæ­¢ã™ã‚‹';
        btn.classList.add('recording');
    }

    function stopRecording() {
        recognition.stop();
        isRecording = false;
        const btn = document.getElementById('record-btn');
        btn.innerHTML = 'ğŸ¤ ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹';
        btn.classList.remove('recording');
    }

    function addDiaryEntry(text) {
        const now = new Date();
        const dateStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        
        appData.diary.unshift({ date: dateStr, text: text }); // å…ˆé ­ã«è¿½åŠ 
        saveData();
        renderDiary();
    }

    function renderDiary() {
        const list = document.getElementById('diary-list');
        list.innerHTML = '';
        
        appData.diary.forEach(entry => {
            const li = document.createElement('li');
            const dateSpan = document.createElement('span');
            dateSpan.className = 'diary-date';
            dateSpan.textContent = entry.date;
            
            li.appendChild(dateSpan);
            li.appendChild(document.createTextNode(entry.text));
            list.appendChild(li);
        });
    }

    // åˆæœŸèµ·å‹•
    window.onload = loadData;

</script>
</body>
</html>